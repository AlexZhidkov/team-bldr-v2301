<mat-progress-bar *ngIf="isLoading" mode="indeterminate"></mat-progress-bar>
<mat-card>
    <mat-card-header>
        <mat-card-title>{{isNewEvent ? "New Event" : (teamEvent | async)?.title}}</mat-card-title>
    </mat-card-header>
    <mat-card-content [ngSwitch]="isOwner">
        <div *ngSwitchCase="true">
            <div fxLayout='row'>
                <mat-form-field fxFlex="55%">
                    <mat-label>Choose a date</mat-label>
                    <input matInput [min]="minDate" [matDatepicker]="picker" [ngModel]="eventDate"
                        (dateChange)="updateEventDate($event.value)">
                    <mat-hint>MM/DD/YYYY</mat-hint>
                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
                <mat-form-field fxFlex="45%">
                    <input type="time" matInput placeholder="Start Time" [ngModel]="eventTime" name="startTime"
                        (ngModelChange)="updateEventTime($event)">
                </mat-form-field>
            </div>
            <mat-form-field class="full-width">
                <mat-label>Title</mat-label>
                <input matInput name="eventTitle" [ngModel]="(teamEvent | async)?.title"
                    (ngModelChange)="teamEventDoc?.update({title: $event})">
            </mat-form-field>
            <mat-form-field class="full-width">
                <mat-label>Description</mat-label>
                <textarea matInput name="eventDescription" [ngModel]="(teamEvent | async)?.description"
                    (ngModelChange)="teamEventDoc?.update({description: $event})"></textarea>
            </mat-form-field>
        </div>
        <div *ngSwitchCase="false">
            <p>{{eventDate.toLocaleString("en-AU", {dateStyle: "full", timeStyle: "short"})}}</p>
            <p>{{(teamEvent | async)?.description}}</p>
        </div>
    </mat-card-content>
    <div [ngSwitch]="isOwner">
        <mat-card-actions *ngSwitchCase="true">
            <button mat-raised-button color="primary" (click)="joinEvent()">
                <mat-icon inline=true>{{isJoined ? "person_remove" : "person_add"}}</mat-icon>
                {{isJoined ? "LEAVE" : "JOIN"}}
            </button>
            <button mat-raised-button (click)="copyEventInvite()">
                <mat-icon inline=true>content_copy</mat-icon>
                INVITE
            </button>
            <button mat-raised-button (click)="duplicateEvent()">
                <mat-icon inline=true>file_copy</mat-icon>
                DUPLICATE
            </button>
            <button mat-icon-button [matMenuTriggerFor]="menu">
                <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
                <button mat-raised-button color="warn" (click)="deleteEvent()">
                    <mat-icon>delete</mat-icon>
                    DELETE
                </button>
            </mat-menu>
        </mat-card-actions>
        <mat-card-actions *ngSwitchCase="false">
            <button mat-raised-button color="primary" (click)="joinEvent()">
                <mat-icon inline=true>{{isJoined ? "person_remove" : "person_add"}}</mat-icon>
                {{isJoined ? "LEAVE" : "JOIN"}}
            </button>
        </mat-card-actions>
    </div>
</mat-card>

<mat-tab-group>
    <mat-tab label="Participants">
        <app-event-participants [eventId]="eventId"></app-event-participants>
    </mat-tab>
    <mat-tab label="Messages">
        <app-messages [eventId]="eventId"></app-messages>
    </mat-tab>
</mat-tab-group>